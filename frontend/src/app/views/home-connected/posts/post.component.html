<!-- Blog Wrapper Start -->
<section class="page-header section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h1 class="section-title h2 mb-3">
          <span>Recent posts</span>
        </h1>
      </div>
    </div>
  </div>
</section>

<section>
  <div class="container">
    <div class="row gy-5 gx-4 g-xl-5 justify-content-center" *ngIf="posts && posts.length > 0">
      <div class="col-lg-8" *ngFor="let post of posts">
        <article class="facebook-post border rounded p-3 mb-3 bg-white">
          <!-- Profile and Timestamp -->
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="d-flex align-items-center">
              <img 
                [src]="'http://localhost:2000/getImage/' + post.userId.image" 
                alt="User Image" 
                class="rounded-circle me-2" 
                width="40" 
                height="40"
              >
              <div>
                <a 
                  [routerLink]="['/profil/view', post.userId._id]" 
                  class="fw-bold text-dark unstyled-link">
                  {{ post.userId.firstName }} {{ post.userId.lastName }}
                </a>
                <div class="text-muted small">{{ post.createdAt | date }}</div>
              </div>
            </div>

            <!-- Mat-Menu for edit/delete -->
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="menu" 
              *ngIf="isAuthor(post)"
            >
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item [routerLink]="['/post/edit', post._id]">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="deletePost(post)">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </div>

          <!-- Post Content -->
          <div class="post-content mb-2">
            <a 
              [routerLink]="['/post/show', post._id]" 
              class="unstyled-link">
              <h5 class="fw-normal">{{ post.title }}</h5>
            </a>
            <p class="wrap-text">{{ post.content }}</p>
          </div>

          <!-- Post Image -->
          <div *ngIf="post.image" class="post-image mb-2">
            <img 
              class="img-fluid rounded" 
              [src]="'http://localhost:2000/getImage/' + post.image" 
              alt="Post Image"
            >
          </div>

        <!-- Interaction Section -->
<div class="post-actions-container">
  <!-- Affichage du nombre de likes et commentaires -->
  <div class="interaction-counts d-flex align-items-center justify-content-between mb-2">
    <div class="likes-count d-flex align-items-center">
      <i class="ti ti-thumb-up"></i>
      <span *ngIf="likeCounts[post._id] !== undefined" class="ms-1">
        {{ likeCounts[post._id] }}
      </span>
    </div>
    <div class="comments-count d-flex align-items-center">
      <i class="ti ti-comment"></i>
      <span *ngIf="commentCounts[post._id] !== undefined" class="ms-1">
        {{ commentCounts[post._id] }} comments
      </span>
    </div>
  </div>

<!-- Barre des boutons -->
<div class="post-actions d-flex justify-content-around pt-2 border-top">
  <button 
  class="btn" 
  (click)="likePost(post._id)"
  [ngStyle]="{'color': likedPosts[post._id] ? 'blue' : 'black'}">
  <i class="ti ti-thumb-up"></i>
  Like
</button>




  
  <button class="btn btn-light text-muted">
    <i class="ti ti-comment"></i> Comment
  </button>
  <button class="btn btn-light text-muted">
    <i class="ti ti-share"></i> Share
  </button>
</div>

</div>

        </article>
      </div>

      <div class="col-12 text-center">
        <a 
          class="btn btn-primary mt-5" 
          href="blog.html" 
          aria-label="View all posts">
          <i class="ti ti-new-section me-2"></i>View all posts
        </a>
      </div>
    </div>
  </div>
</section>
